<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Funcionários Ativos - RH Evoluído</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <nav class="menu">
      <ul>
        <li><a href="index.html">Início</a></li>
        <li><a href="cadastro.html">Cadastrar Funcionário</a></li>
        <li><a href="ativos.html">Funcionários Ativos</a></li>
        <li><a href="inativos.html">Funcionários Inativos</a></li>
        <li><a href="ferias.html">Lançar Férias</a></li>
        <li><a href="demissao.html">Registrar Demissão</a></li>
        <li><a href="aviso.html">Aviso Prévio</a></li>
        <li><a href="relatorio.html">Gerar Relatório</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="container">
      <h1>Funcionários Ativos</h1>
      <label for="ordenar">Ordenar por:</label>
      <select id="ordenar">
        <option value="nome">Nome (A-Z)</option>
        <option value="data">Data (mais recente)</option>
      </select>

      <ul id="lista-funcionarios"></ul>
    </section>
  </main>

  <script>
    const lista = document.getElementById("lista-funcionarios");
    const ordenar = document.getElementById("ordenar");

    function carregarFuncionarios() {
      return JSON.parse(localStorage.getItem("funcionariosAtivos") || "[]");
    }

    function salvarFuncionarios(funcionarios) {
      localStorage.setItem("funcionariosAtivos", JSON.stringify(funcionarios));
    }

    function renderizar() {
      let funcionarios = carregarFuncionarios();

      if (ordenar.value === "nome") {
        funcionarios.sort((a, b) => a.nome.localeCompare(b.nome));
      } else {
        funcionarios.sort((a, b) => new Date(b.dataCadastro) - new Date(a.dataCadastro));
      }

      lista.innerHTML = "";

      funcionarios.forEach((f, i) => {
        const li = document.createElement("li");
        li.innerHTML = `
          <strong>${f.nome}</strong> - CPF: ${f.cpf} - Local: ${f.local} - Data: ${f.dataCadastro}
          <button onclick="editar(${i})">Editar</button>
          <button onclick="excluir(${i})">Excluir</button>
          <button onclick="inativar(${i})">Inativar</button>
        `;
        lista.appendChild(li);
      });
    }

    function editar(index) {
      let funcionarios = carregarFuncionarios();
      const f = funcionarios[index];
      const novoNome = prompt("Editar Nome:", f.nome);
      if (novoNome === null || novoNome.trim() === "") return alert("Nome inválido");
      const novoCpf = prompt("Editar CPF:", f.cpf);
      if (novoCpf === null || novoCpf.trim() === "") return alert("CPF inválido");
      const novoLocal = prompt("Editar Local:", f.local);
      if (novoLocal === null || novoLocal.trim() === "") return alert("Local inválido");
      const novaData = prompt("Editar Data (AAAA-MM-DD):", f.dataCadastro);
      if (novaData === null || isNaN(Date.parse(novaData))) return alert("Data inválida");

      funcionarios[index] = {
        nome: novoNome.trim(),
        cpf: novoCpf.trim(),
        local: novoLocal.trim(),
        dataCadastro: novaData.trim(),
      };
      salvarFuncionarios(funcionarios);
      renderizar();
    }

    function excluir(index) {
      if (!confirm("Deseja realmente excluir este funcionário?")) return;
      let funcionarios = carregarFuncionarios();
      funcionarios.splice(index, 1);
      salvarFuncionarios(funcionarios);
      renderizar();
    }

    function inativar(index) {
      let ativos = carregarFuncionarios();
      let inativos = JSON.parse(localStorage.getItem("funcionariosInativos") || "[]");

      const [func] = ativos.splice(index, 1);
      inativos.push(func);

      localStorage.setItem("funcionariosAtivos", JSON.stringify(ativos));
      localStorage.setItem("funcionariosInativos", JSON.stringify(inativos));

      renderizar();
    }

    ordenar.addEventListener("change", renderizar);

    renderizar();
  </script>
</body>
</html>
