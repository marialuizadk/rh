<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Aviso Prévio</title>
<link rel="stylesheet" href="style.css" />
<script src="menu.js" defer></script>
</head>
<body>
  <div class="container">
    <h1>Aviso Prévio</h1>

    <form id="formAviso">
      <label for="nome">Nome:</label>
      <input type="text" id="nome" required />
      <label for="cpf">CPF:</label>
      <input type="text" id="cpf" required />
      <label for="dataInicio">Data Início:</label>
      <input type="date" id="dataInicio" required />
      <label for="dataFim">Data Fim:</label>
      <input type="date" id="dataFim" readonly />
      <label for="local">Local:</label>
      <input type="text" id="local" required />
      <button type="submit">Registrar Aviso</button>
    </form>

    <div class="sort-container" style="margin-top:30px;">
      <label for="ordenarAviso">Ordenar por:</label>
      <select id="ordenarAviso">
        <option value="nome">Nome (A-Z)</option>
        <option value="dataInicio">Data Início (Mais recente)</option>
      </select>
    </div>

    <table id="tabelaAviso">
      <thead>
        <tr>
          <th>Nome</th><th>CPF</th><th>Data Início</th><th>Data Fim</th><th>Local</th><th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    function formatDateISOtoBR(isoStr) {
      const d = new Date(isoStr);
      return d.toLocaleDateString('pt-BR');
    }

    const dataInicioInput = document.getElementById('dataInicio');
    const dataFimInput = document.getElementById('dataFim');

    dataInicioInput.addEventListener('change', () => {
      if (dataInicioInput.value) {
        const data = new Date(dataInicioInput.value);
        data.setDate(data.getDate() + 7); // soma 7 dias para fim do aviso
        const yyyy = data.getFullYear();
        const mm = String(data.getMonth() + 1).padStart(2, '0');
        const dd = String(data.getDate()).padStart(2, '0');
        dataFimInput.value = `${yyyy}-${mm}-${dd}`;
      } else {
        dataFimInput.value = '';
      }
    });

    function ordenarLista(lista, criterio) {
      if (criterio === 'nome') {
        return lista.sort((a,b) => a.nome.localeCompare(b.nome));
      }
      if (criterio === 'dataInicio') {
        return lista.sort((a,b) => new Date(b.dataInicio) - new Date(a.dataInicio));
      }
      return lista;
    }

    function carregarAviso() {
      const lista = JSON.parse(localStorage.getItem('avisoPrevio')) || [];
      const tbody = document.querySelector('#tabelaAviso tbody');
      const criterio = document.getElementById('ordenarAviso').value;
      const listaOrdenada = ordenarLista(lista, criterio);

      tbody.innerHTML = '';
      listaOrdenada.forEach((f, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${f.nome}</td>
          <td>${f.cpf}</td>
          <td>${formatDateISOtoBR(f.dataInicio)}</td>
          <td>${formatDateISOtoBR(f.dataFim)}</td>
          <td>${f.local}</td>
          <td class="actions">
            <button class="edit" onclick="editarAviso(${idx})">Editar</button>
            <button class="delete" onclick="excluirAviso(${idx})">Excluir</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    document.getElementById('formAviso').addEventListener('submit', e => {
      e.preventDefault();
      const nome = document.getElementById('nome').value.trim();
      const cpf = document.getElementById('cpf').value.trim();
      const dataInicio = document.getElementById('dataInicio').value;
      const dataFim = document.getElementById('dataFim').value;
      const local = document.getElementById('local').value.trim();

      if (!nome || !cpf || !dataInicio || !dataFim || !local) {
        alert('Preencha todos os campos!');
        return;
      }

      let aviso = JSON.parse(localStorage.getItem('avisoPrevio')) || [];
      aviso.push({
        nome,
        cpf,
        dataInicio: new Date(dataInicio).toISOString(),
        dataFim: new Date(dataFim).toISOString(),
        local
      });

      localStorage.setItem('avisoPrevio', JSON.stringify(aviso));
      alert('Aviso prévio registrado com sucesso!');
      e.target.reset();
      carregarAviso();
    });

    function editarAviso(idx) {
      let lista = JSON.parse(localStorage.getItem('avisoPrevio')) || [];
      const f = lista[idx];
      if (!f) return alert('Registro não encontrado.');

      const novoNome = prompt('Editar nome:', f.nome);
      if (novoNome === null) return;
      const novoCpf = prompt('Editar CPF:', f.cpf);
      if (novoCpf === null) return;
      const novaDataInicio = prompt('Editar data início (YYYY-MM-DD):', f.dataInicio.slice(0,10));
      if (novaDataInicio === null) return;
      const novaDataFim = prompt('Editar data fim (YYYY-MM-DD):', f.dataFim.slice(0,10));
      if (novaDataFim === null) return;
      const novoLocal = prompt('Editar local:', f.local);
      if (novoLocal === null) return;

      if (!novoNome.trim() || !novoCpf.trim() || !novaDataInicio.trim() || !novaDataFim.trim() || !novoLocal.trim()) {
        alert('Campos não podem ficar vazios.');
        return;
      }

      lista[idx] = {
        nome: novoNome.trim(),
        cpf: novoCpf.trim(),
        dataInicio: new Date(novaDataInicio).toISOString(),
        dataFim: new Date(novaDataFim).toISOString(),
        local: novoLocal.trim()
      };

      localStorage.setItem('avisoPrevio', JSON.stringify(lista));
      carregarAviso();
    }

    function excluirAviso(idx) {
      if (!confirm('Confirma exclusão do registro?')) return;
      let lista = JSON.parse(localStorage.getItem('avisoPrevio')) || [];
      lista.splice(idx, 1);
      localStorage.setItem('avisoPrevio', JSON.stringify(lista));
      carregarAviso();
    }

    document.getElementById('ordenarAviso').addEventListener('change', carregarAviso);
    window.onload = carregarAviso;
  </script>
</body>
</html>
