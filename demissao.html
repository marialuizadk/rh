<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registrar Demissão - RH Evoluído</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <nav class="menu">
      <ul>
        <li><a href="index.html">Início</a></li>
        <li><a href="cadastro.html">Cadastrar Funcionário</a></li>
        <li><a href="ativos.html">Funcionários Ativos</a></li>
        <li><a href="inativos.html">Funcionários Inativos</a></li>
        <li><a href="ferias.html">Lançar Férias</a></li>
        <li><a href="demissao.html">Registrar Demissão</a></li>
        <li><a href="aviso.html">Aviso Prévio</a></li>
        <li><a href="relatorio.html">Gerar Relatório</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="container">
      <h1>Registrar Demissão</h1>

      <form id="form-demissao">
        <label for="nome">Nome:</label>
        <input type="text" id="nome" required />

        <label for="cpf">CPF:</label>
        <input type="text" id="cpf" required />

        <label for="local">Local:</label>
        <input type="text" id="local" required />

        <label for="dataDemissao">Data da Demissão:</label>
        <input type="date" id="dataDemissao" required />

        <label for="motivo">Motivo:</label>
        <input type="text" id="motivo" required />

        <button type="submit">Registrar Demissão</button>
      </form>

      <h2>Demissões Registradas</h2>
      <ul id="lista-demissoes"></ul>
    </section>
  </main>

  <script>
    const form = document.getElementById("form-demissao");
    const lista = document.getElementById("lista-demissoes");

    function carregarDemissoes() {
      return JSON.parse(localStorage.getItem("demissoes") || "[]");
    }

    function salvarDemissoes(demissoes) {
      localStorage.setItem("demissoes", JSON.stringify(demissoes));
    }

    function carregarInativos() {
      return JSON.parse(localStorage.getItem("funcionariosInativos") || "[]");
    }

    function salvarInativos(inativos) {
      localStorage.setItem("funcionariosInativos", JSON.stringify(inativos));
    }

    function renderizar() {
      const demissoes = carregarDemissoes();
      lista.innerHTML = "";

      demissoes.forEach((d, i) => {
        const li = document.createElement("li");
        li.innerHTML = `
          <strong>${d.nome}</strong> - CPF: ${d.cpf} - Local: ${d.local} - Data: ${d.dataDemissao} - Motivo: ${d.motivo}
          <button onclick="editar(${i})">Editar</button>
          <button onclick="excluir(${i})">Excluir</button>
        `;
        lista.appendChild(li);
      });
    }

    function editar(index) {
      let demissoes = carregarDemissoes();
      const d = demissoes[index];

      const novoNome = prompt("Editar Nome:", d.nome);
      if (novoNome === null || novoNome.trim() === "") return alert("Nome inválido");
      const novoCpf = prompt("Editar CPF:", d.cpf);
      if (novoCpf === null || novoCpf.trim() === "") return alert("CPF inválido");
      const novoLocal = prompt("Editar Local:", d.local);
      if (novoLocal === null || novoLocal.trim() === "") return alert("Local inválido");
      const novaData = prompt("Editar Data da Demissão (AAAA-MM-DD):", d.dataDemissao);
      if (novaData === null || isNaN(Date.parse(novaData))) return alert("Data inválida");
      const novoMotivo = prompt("Editar Motivo:", d.motivo);
      if (novoMotivo === null || novoMotivo.trim() === "") return alert("Motivo inválido");

      demissoes[index] = {
        nome: novoNome.trim(),
        cpf: novoCpf.trim(),
        local: novoLocal.trim(),
        dataDemissao: novaData.trim(),
        motivo: novoMotivo.trim()
      };

      salvarDemissoes(demissoes);

      // Atualizar também na lista de inativos
      let inativos = carregarInativos();
      const idxInativo = inativos.findIndex(f => f.cpf === d.cpf);
      if (idxInativo >= 0) {
        inativos[idxInativo] = demissoes[index];
        salvarInativos(inativos);
      }

      renderizar();
    }

    function excluir(index) {
      if (!confirm("Deseja realmente excluir este registro?")) return;

      let demissoes = carregarDemissoes();
      let inativos = carregarInativos();

      const removido = demissoes.splice(index, 1)[0];

      // Também remove da lista de inativos
      inativos = inativos.filter(f => f.cpf !== removido.cpf);

      salvarDemissoes(demissoes);
      salvarInativos(inativos);

      renderizar();
    }

    form.addEventListener("submit", e => {
      e.preventDefault();

      const novaDemissao = {
        nome: form.nome.value.trim(),
        cpf: form.cpf.value.trim(),
        local: form.local.value.trim(),
        dataDemissao: form.dataDemissao.value,
        motivo: form.motivo.value.trim(),
      };

      if (!novaDemissao.nome || !novaDemissao.cpf || !novaDemissao.local || !novaDemissao.dataDemissao || !novaDemissao.motivo) {
        alert("Preencha todos os campos.");
        return;
      }

      // Salvar na lista de demissões
      let demissoes = carregarDemissoes();
      demissoes.push(novaDemissao);
      salvarDemissoes(demissoes);

      // Também adicionar na lista de inativos
      let inativos = carregarInativos();
      inativos.push(novaDemissao);
      salvarInativos(inativos);

      form.reset();
      renderizar();
    });

    renderizar();
  </script>
</body>
</html>
