<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Funcionários Inativos</title>
<link rel="stylesheet" href="style.css" />
<script src="menu.js" defer></script>
</head>
<body>
  <div class="container">
    <h1>Funcionários Inativos</h1>

    <div class="sort-container">
      <label for="ordenarInativos">Ordenar por:</label>
      <select id="ordenarInativos">
        <option value="nome">Nome (A-Z)</option>
        <option value="dataDemissao">Data Demissão (Mais recente)</option>
      </select>
    </div>

    <table id="tabelaInativos">
      <thead>
        <tr>
          <th>Nome</th><th>CPF</th><th>Data Demissão</th><th>Motivo</th><th>Local</th><th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    function formatDateISOtoBR(isoStr) {
      const d = new Date(isoStr);
      return d.toLocaleDateString('pt-BR');
    }

    function ordenarLista(lista, criterio) {
      if (criterio === 'nome') {
        return lista.sort((a,b) => a.nome.localeCompare(b.nome));
      }
      if (criterio === 'dataDemissao') {
        return lista.sort((a,b) => new Date(b.dataDemissao) - new Date(a.dataDemissao));
      }
      return lista;
    }

    function carregarInativos() {
      const lista = JSON.parse(localStorage.getItem('funcionariosInativos')) || [];
      const tbody = document.querySelector('#tabelaInativos tbody');
      const criterio = document.getElementById('ordenarInativos').value;
      const listaOrdenada = ordenarLista(lista, criterio);

      tbody.innerHTML = '';
      listaOrdenada.forEach((f, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${f.nome}</td>
          <td>${f.cpf}</td>
          <td>${formatDateISOtoBR(f.dataDemissao)}</td>
          <td>${f.motivo}</td>
          <td>${f.local}</td>
          <td class="actions">
            <button class="edit" onclick="editarInativo(${idx})">Editar</button>
            <button class="delete" onclick="excluirInativo(${idx})">Excluir</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function editarInativo(idx) {
      let lista = JSON.parse(localStorage.getItem('funcionariosInativos')) || [];
      const f = lista[idx];
      if (!f) return alert('Funcionário não encontrado.');

      const novoNome = prompt('Editar nome:', f.nome);
      if (novoNome === null) return;
      const novoCpf = prompt('Editar CPF:', f.cpf);
      if (novoCpf === null) return;
      const novaData = prompt('Editar data demissão (YYYY-MM-DD):', f.dataDemissao.slice(0,10));
      if (novaData === null) return;
      const novoMotivo = prompt('Editar motivo:', f.motivo);
      if (novoMotivo === null) return;
      const novoLocal = prompt('Editar local:', f.local);
      if (novoLocal === null) return;

      if (!novoNome.trim() || !novoCpf.trim() || !novaData.trim() || !novoMotivo.trim() || !novoLocal.trim()) {
        alert('Campos não podem ficar vazios.');
        return;
      }

      lista[idx] = {
        nome: novoNome.trim(),
        cpf: novoCpf.trim(),
        dataDemissao: new Date(novaData).toISOString(),
        motivo: novoMotivo.trim(),
        local: novoLocal.trim()
      };
      localStorage.setItem('funcionariosInativos', JSON.stringify(lista));
      carregarInativos();
    }

    function excluirInativo(idx) {
      if (!confirm('Confirma exclusão do funcionário?')) return;
      let lista = JSON.parse(localStorage.getItem('funcionariosInativos')) || [];
      lista.splice(idx, 1);
      localStorage.setItem('funcionariosInativos', JSON.stringify(lista));
      carregarInativos();
    }

    document.getElementById('ordenarInativos').addEventListener('change', carregarInativos);
    window.onload = carregarInativos;
  </script>
</body>
</html>
